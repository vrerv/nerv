<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>ğŸ€ ì´ì†Œë¯¸ì˜ ì¤„ë„˜ê¸° ê²Œì„</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      touch-action: manipulation;
    }
    
    .game-container {
      position: relative;
      width: 100%;
      max-width: 400px;
      height: 500px;
      background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 70%, #8B4513 100%);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .score-board {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.9);
      padding: 10px 30px;
      border-radius: 30px;
      font-size: 24px;
      font-weight: bold;
      color: #764ba2;
      z-index: 10;
    }
    
    .game-area {
      position: absolute;
      bottom: 50px;
      left: 50%;
      transform: translateX(-50%);
      width: 300px;
      height: 300px;
    }
    
    /* ìºë¦­í„° */
    .character {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 80px;
      transition: bottom 0.12s ease-out, transform 0.12s ease-out;
      z-index: 5;
    }
    
    .character.jumping {
      bottom: 110px;
      transform: translateX(-50%) scale(0.95);
    }
    
    /* ìºë¦­í„° ê·¸ë¦¼ì */
    .character-shadow {
      position: absolute;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 15px;
      background: rgba(0,0,0,0.2);
      border-radius: 50%;
      transition: all 0.15s ease-out;
      z-index: 2;
    }
    
    .character.jumping ~ .character-shadow {
      width: 30px;
      height: 8px;
      opacity: 0.5;
    }
    
    .character-body {
      position: relative;
      width: 100%;
      height: 100%;
    }
    
    .head {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 35px;
      height: 35px;
      background: #FFE4C4;
      border-radius: 50%;
      border: 2px solid #DEB887;
    }
    
    .hair {
      position: absolute;
      top: -5px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 25px;
      background: #4a3728;
      border-radius: 50% 50% 0 0;
    }
    
    .eyes {
      position: absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
    }
    
    .eye {
      width: 5px;
      height: 5px;
      background: #333;
      border-radius: 50%;
    }
    
    .mouth {
      position: absolute;
      top: 22px;
      left: 50%;
      transform: translateX(-50%);
      width: 8px;
      height: 4px;
      background: #FF6B6B;
      border-radius: 0 0 10px 10px;
    }
    
    .body {
      position: absolute;
      top: 32px;
      left: 50%;
      transform: translateX(-50%);
      width: 30px;
      height: 35px;
      background: #FF69B4;
      border-radius: 10px 10px 5px 5px;
    }
    
    .skirt {
      position: absolute;
      top: 55px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 15px;
      background: #FF1493;
      border-radius: 0 0 20px 20px;
    }
    
    .legs {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
    }
    
    .leg {
      width: 8px;
      height: 20px;
      background: #FFE4C4;
      border-radius: 0 0 5px 5px;
    }
    
    /* ì¤„ë„˜ê¸° ì¤„ */
    .rope-container {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      width: 200px;
      height: 200px;
      pointer-events: none;
    }
    
    .rope {
      position: absolute;
      bottom: 0;
      left: 50%;
      width: 200px;
      height: 4px;
      background: linear-gradient(90deg, #FF6B6B, #FF8E53, #FFD93D, #6BCB77, #4D96FF, #9B59B6);
      border-radius: 4px;
      transform-origin: center bottom;
      transform: translateX(-50%) rotate(0deg);
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      transition: filter 0.1s, opacity 0.1s;
    }
    
    .rope-handle {
      position: absolute;
      bottom: 10px;
      width: 15px;
      height: 30px;
      background: linear-gradient(to bottom, #8B4513, #A0522D);
      border-radius: 3px;
    }
    
    .rope-handle.left {
      left: 30px;
    }
    
    .rope-handle.right {
      right: 30px;
    }
    
    /* ë©”ì‹œì§€ */
    .message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.95);
      padding: 30px 40px;
      border-radius: 20px;
      text-align: center;
      z-index: 20;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }
    
    .message h2 {
      color: #764ba2;
      margin-bottom: 10px;
      font-size: 28px;
    }
    
    .message p {
      color: #666;
      margin-bottom: 20px;
      font-size: 18px;
    }
    
    .message .final-score {
      font-size: 48px;
      color: #FF6B6B;
      font-weight: bold;
      margin: 15px 0;
    }
    
    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 20px;
      border-radius: 30px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .btn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5);
    }
    
    .btn:active {
      transform: scale(0.95);
    }
    
    .hidden {
      display: none !important;
    }
    
    .tap-hint {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 16px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .combo {
      position: absolute;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 20px;
      color: #FFD700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      font-weight: bold;
    }
    
    .timing-indicator {
      position: absolute;
      bottom: 130px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.2s;
    }
    
    .timing-indicator.perfect {
      color: #FFD700;
    }
    
    .timing-indicator.good {
      color: #6BCB77;
    }
    
    .timing-indicator.miss {
      color: #FF6B6B;
    }
    
    .timing-indicator.double {
      color: #FF69B4;
      font-size: 28px;
      text-shadow: 0 0 10px #FF69B4, 0 0 20px #FFD700;
    }
    
    /* 2ë‹¨ ë›°ê¸° í° ì•Œë¦¼ */
    .double-jump-alert {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      font-size: 48px;
      font-weight: bold;
      color: #FF69B4;
      text-shadow: 
        0 0 10px #FFD700,
        0 0 20px #FF69B4,
        0 0 30px #FFD700,
        2px 2px 0 #fff;
      z-index: 100;
      pointer-events: none;
      opacity: 0;
    }
    
    .double-jump-alert.show {
      animation: doubleJumpPop 0.8s ease-out forwards;
    }
    
    @keyframes doubleJumpPop {
      0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
      }
      20% {
        transform: translate(-50%, -50%) scale(1.3);
        opacity: 1;
      }
      40% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
      100% {
        transform: translate(-50%, -50%) scale(1.2) translateY(-30px);
        opacity: 0;
      }
    }
    
    /* ë°°ê²½ ë°˜ì§ì„ */
    .game-container.flash {
      animation: bgFlash 0.3s ease-out;
    }
    
    @keyframes bgFlash {
      0%, 100% { box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
      50% { box-shadow: 0 0 60px #FFD700, 0 0 100px #FF69B4; }
    }
    
    /* ğŸ¶ ë¬¼ë³‘ ì•„ì´í…œ */
    .item-slot {
      position: absolute;
      top: 120px;
      width: 50px;
      height: 50px;
      z-index: 15;
    }
    
    .item-slot.left {
      left: 15px;
    }
    
    .item-slot.right {
      right: 15px;
    }
    
    .water-bottle {
      width: 100%;
      height: 100%;
      background: linear-gradient(180deg, #87CEEB 0%, #4FC3F7 50%, #29B6F6 100%);
      border-radius: 8px 8px 15px 15px;
      border: 3px solid #0288D1;
      cursor: pointer;
      position: relative;
      animation: itemBounce 0.5s ease-out, itemFloat 2s ease-in-out infinite;
      box-shadow: 0 4px 15px rgba(41, 182, 246, 0.5);
      transition: transform 0.1s;
    }
    
    .water-bottle:hover {
      transform: scale(1.1);
    }
    
    .water-bottle:active {
      transform: scale(0.95);
    }
    
    .water-bottle::before {
      content: '';
      position: absolute;
      top: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 10px;
      background: #0288D1;
      border-radius: 3px 3px 0 0;
    }
    
    .water-bottle::after {
      content: 'ğŸ’§';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
    }
    
    @keyframes itemBounce {
      0% { transform: scale(0) rotate(-20deg); opacity: 0; }
      50% { transform: scale(1.2) rotate(10deg); opacity: 1; }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }
    
    @keyframes itemFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    /* ìŠ¬ë¡œìš° ëª¨ë“œ íš¨ê³¼ */
    .game-container.slow-mode {
      animation: slowPulse 0.5s ease-in-out infinite;
    }
    
    .game-container.slow-mode::after {
      content: 'â¸ï¸ FREEZE';
      position: absolute;
      top: 85px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      color: #29B6F6;
      font-weight: bold;
      text-shadow: 0 0 5px white;
      z-index: 20;
    }
    
    @keyframes slowPulse {
      0%, 100% { border: 3px solid transparent; }
      50% { border: 3px solid #29B6F6; }
    }
    
    @keyframes countdownPulse {
      0% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
      20% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
      80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.5; }
    }
    
    /* ì—°ì† í¼í™íŠ¸ ì¹´ìš´í„° */
    .perfect-streak {
      position: absolute;
      top: 85px;
      right: 15px;
      font-size: 14px;
      color: #FFD700;
      font-weight: bold;
      text-shadow: 0 1px 3px rgba(0,0,0,0.3);
      z-index: 15;
    }
    
    .timing-indicator.show {
      opacity: 1;
      animation: floatUp 0.5s ease-out forwards;
    }
    
    @keyframes floatUp {
      0% { transform: translateX(-50%) translateY(0); opacity: 1; }
      100% { transform: translateX(-50%) translateY(-30px); opacity: 0; }
    }
    
    /* ë‚œì´ë„ í‘œì‹œ */
    .difficulty {
      position: absolute;
      top: 55px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      color: rgba(255,255,255,0.8);
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <div class="game-container" id="gameContainer">
    <div class="score-board">
      <span id="score">0</span>ì 
    </div>
    <div class="combo hidden" id="combo"></div>
    <div class="difficulty" id="difficulty">Lv.1</div>
    <div class="perfect-streak" id="perfectStreak"></div>
    
    <!-- ì•„ì´í…œ ìŠ¬ë¡¯ -->
    <div class="item-slot left" id="itemSlotLeft"></div>
    <div class="item-slot right" id="itemSlotRight"></div>
    
    <div class="game-area">
      <div class="rope-container" id="ropeContainer">
        <div class="rope" id="rope"></div>
        <div class="rope-handle left"></div>
        <div class="rope-handle right"></div>
      </div>
      
      <div class="character" id="character">
        <div class="character-body">
          <div class="hair"></div>
          <div class="head">
            <div class="eyes">
              <div class="eye"></div>
              <div class="eye"></div>
            </div>
            <div class="mouth"></div>
          </div>
          <div class="body"></div>
          <div class="skirt"></div>
          <div class="legs">
            <div class="leg"></div>
            <div class="leg"></div>
          </div>
        </div>
      </div>
      <div class="character-shadow"></div>
    </div>
    
    <div class="timing-indicator" id="timingIndicator"></div>
    <div class="double-jump-alert" id="doubleJumpAlert">ğŸŒŸ 2ë‹¨ ë›°ê¸°! ğŸŒŸ</div>
    <div class="tap-hint" id="tapHint">ğŸ‘† í„°ì¹˜í•´ì„œ ì í”„!</div>
    
    <!-- ì‹œì‘ í™”ë©´ -->
    <div class="message" id="startScreen">
      <h2>ğŸ€ ì´ì†Œë¯¸ì˜ ì¤„ë„˜ê¸°</h2>
      <p>ì¤„ì´ ë‚´ë ¤ì˜¬ ë•Œ í„°ì¹˜í•´ì„œ ì í”„í•˜ì„¸ìš”!</p>
      <button class="btn" id="startBtn">ì‹œì‘í•˜ê¸°</button>
    </div>
    
    <!-- ê²Œì„ ì˜¤ë²„ í™”ë©´ -->
    <div class="message hidden" id="gameOverScreen">
      <h2>ğŸ˜… ê±¸ë ¸ë‹¤!</h2>
      <p>ìµœì¢… ì ìˆ˜</p>
      <div class="final-score" id="finalScore">0</div>
      <button class="btn" id="restartBtn">ë‹¤ì‹œí•˜ê¸°</button>
    </div>
  </div>

  <script>
    // ğŸ”Š ì‚¬ìš´ë“œ ì‹œìŠ¤í…œ
    const sound = {
      audioCtx: null,
      
      init() {
        this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      },
      
      ensureContext() {
        if (!this.audioCtx) this.init();
        if (this.audioCtx.state === 'suspended') {
          this.audioCtx.resume();
        }
      },
      
      // ì„±ê³µ ì†Œë¦¬ (Perfect) - ë°ê³  ë†’ì€ ìŒ
      perfect() {
        this.ensureContext();
        this.playTone([880, 1100, 1320], 0.15, 'sine', 0.3);
      },
      
      // ì„±ê³µ ì†Œë¦¬ (Good) - ì¤‘ê°„ ìŒ
      good() {
        this.ensureContext();
        this.playTone([660, 880], 0.12, 'sine', 0.25);
      },
      
      // ì í”„ ì†Œë¦¬
      jump() {
        this.ensureContext();
        this.playTone([440, 550], 0.08, 'square', 0.1);
      },
      
      // ì‹¤íŒ¨ ì†Œë¦¬ - ë‚®ê³  ìŠ¬í”ˆ ìŒ
      miss() {
        this.ensureContext();
        this.playTone([220, 180, 140], 0.2, 'sawtooth', 0.3);
      },
      
      // ê²Œì„ ì˜¤ë²„ ì†Œë¦¬
      gameOver() {
        this.ensureContext();
        this.playTone([440, 350, 280, 220], 0.25, 'triangle', 0.4);
      },
      
      // ë ˆë²¨ì—… ì†Œë¦¬
      levelUp() {
        this.ensureContext();
        this.playTone([523, 659, 784, 1047], 0.12, 'sine', 0.3);
      },
      
      // ì½¤ë³´ ì†Œë¦¬
      combo() {
        this.ensureContext();
        this.playTone([700, 900], 0.1, 'sine', 0.15);
      },
      
      // ğŸŒŸ ë”ë¸” ì í”„ ì†Œë¦¬ - í™”ë ¤í•˜ê³  ë†’ì€ ìŒ!
      double() {
        this.ensureContext();
        this.playTone([880, 1100, 1320, 1760], 0.1, 'sine', 0.4);
      },
      
      // ğŸ¶ ì•„ì´í…œ íšë“ ì†Œë¦¬
      itemGet() {
        this.ensureContext();
        this.playTone([523, 659, 784], 0.1, 'sine', 0.3);
      },
      
      // ğŸ¢ ìŠ¬ë¡œìš° ëª¨ë“œ ì†Œë¦¬
      slowMode() {
        this.ensureContext();
        this.playTone([392, 330, 262], 0.15, 'sine', 0.25);
      },
      
      // í†¤ ì¬ìƒ í•¨ìˆ˜
      playTone(frequencies, duration, type = 'sine', volume = 0.3) {
        const ctx = this.audioCtx;
        const now = ctx.currentTime;
        
        frequencies.forEach((freq, i) => {
          const oscillator = ctx.createOscillator();
          const gainNode = ctx.createGain();
          
          oscillator.connect(gainNode);
          gainNode.connect(ctx.destination);
          
          oscillator.type = type;
          oscillator.frequency.setValueAtTime(freq, now + i * duration * 0.8);
          
          gainNode.gain.setValueAtTime(volume, now + i * duration * 0.8);
          gainNode.gain.exponentialRampToValueAtTime(0.01, now + (i + 1) * duration);
          
          oscillator.start(now + i * duration * 0.8);
          oscillator.stop(now + (i + 1) * duration + 0.1);
        });
      }
    };

    const game = {
      score: 0,
      combo: 0,
      isPlaying: false,
      isJumping: false,
      ropeAngle: 0,
      ropeSpeed: 3,  // ê¸°ë³¸ ì†ë„ (ë‚®ì„ìˆ˜ë¡ ëŠë¦¼)
      jumpWindow: { start: 160, end: 200 }, // ì í”„í•´ì•¼ í•˜ëŠ” ê°ë„ ë²”ìœ„
      lastJumpAngle: -1,
      level: 1,
      // ë”ë¸” ì í”„ ì‹œìŠ¤í…œ
      jumpCountThisRotation: 0,  // ì´ë²ˆ íšŒì „ì—ì„œ ì í”„ íšŸìˆ˜
      lastRotation: -1,          // ë§ˆì§€ë§‰ íšŒì „ ë²ˆí˜¸
      
      // ğŸ¶ ì•„ì´í…œ ì‹œìŠ¤í…œ
      perfectStreak: 0,          // ì—°ì† í¼í™íŠ¸ íšŸìˆ˜
      items: [],                 // í˜„ì¬ ì•„ì´í…œë“¤ ['left'] or ['right'] or ['left', 'right']
      isSlowMode: false,         // ì •ì§€ ëª¨ë“œ í™œì„±í™”
      baseRopeSpeed: 3,          // ê¸°ë³¸ ì¤„ ì†ë„ ì €ì¥
      freezeTimer: null,         // ì •ì§€ íƒ€ì´ë¨¸
      countdownTimer: null,      // ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸
      
      elements: {
        score: document.getElementById('score'),
        combo: document.getElementById('combo'),
        difficulty: document.getElementById('difficulty'),
        rope: document.getElementById('rope'),
        ropeContainer: document.getElementById('ropeContainer'),
        character: document.getElementById('character'),
        timingIndicator: document.getElementById('timingIndicator'),
        doubleJumpAlert: document.getElementById('doubleJumpAlert'),
        tapHint: document.getElementById('tapHint'),
        startScreen: document.getElementById('startScreen'),
        gameOverScreen: document.getElementById('gameOverScreen'),
        finalScore: document.getElementById('finalScore'),
        gameContainer: document.getElementById('gameContainer'),
        perfectStreak: document.getElementById('perfectStreak'),
        itemSlotLeft: document.getElementById('itemSlotLeft'),
        itemSlotRight: document.getElementById('itemSlotRight')
      },
      
      init() {
        document.getElementById('startBtn').addEventListener('click', () => this.start());
        document.getElementById('restartBtn').addEventListener('click', () => this.start());
        
        // í„°ì¹˜/í´ë¦­ ì´ë²¤íŠ¸
        this.elements.gameContainer.addEventListener('click', (e) => {
          if (e.target.closest('.message')) return;
          this.jump();
        });
        
        this.elements.gameContainer.addEventListener('touchstart', (e) => {
          if (e.target.closest('.message')) return;
          e.preventDefault();
          this.jump();
        }, { passive: false });
        
        // í‚¤ë³´ë“œ
        document.addEventListener('keydown', (e) => {
          if (e.code === 'Space') {
            e.preventDefault();
            this.jump();
          }
        });
        
        // ë”ë¸”í´ë¦­ í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€
        this.elements.gameContainer.addEventListener('selectstart', (e) => e.preventDefault());
        this.elements.gameContainer.addEventListener('dblclick', (e) => e.preventDefault());
      },
      
      start() {
        // ì‚¬ìš´ë“œ ì´ˆê¸°í™” (ì‚¬ìš©ì ì¸í„°ë™ì…˜ í›„)
        sound.ensureContext();
        
        this.score = 0;
        this.combo = 0;
        this.ropeAngle = 0;
        this.ropeSpeed = 3;
        this.baseRopeSpeed = 3;
        this.level = 1;
        this.isPlaying = true;
        this.lastJumpAngle = -1;
        this.jumpCountThisRotation = 0;
        this.lastRotation = -1;
        
        // ì•„ì´í…œ ì´ˆê¸°í™”
        this.perfectStreak = 0;
        this.items = [];
        this.isSlowMode = false;
        if (this.freezeTimer) clearTimeout(this.freezeTimer);
        if (this.countdownTimer) clearInterval(this.countdownTimer);
        const countdown = document.getElementById('slowCountdown');
        if (countdown) countdown.remove();
        this.elements.itemSlotLeft.innerHTML = '';
        this.elements.itemSlotRight.innerHTML = '';
        this.elements.perfectStreak.textContent = '';
        this.elements.gameContainer.classList.remove('slow-mode');
        
        this.elements.score.textContent = '0';
        this.elements.combo.classList.add('hidden');
        this.elements.difficulty.textContent = 'Lv.1';
        this.elements.startScreen.classList.add('hidden');
        this.elements.gameOverScreen.classList.add('hidden');
        this.elements.tapHint.classList.remove('hidden');
        
        this.gameLoop();
      },
      
      jump() {
        if (!this.isPlaying) return;
        
        // ì í”„ ì¤‘ì´ì–´ë„ ë”ë¸” ì í”„ ì²´í¬ëŠ” í•¨!
        if (this.isJumping) {
          // ì í”„ ì¤‘ ì¶”ê°€ íƒ­ = ë”ë¸” ì í”„ ì‹œë„
          this.checkDoubleJump();
          return;
        }
        
        this.isJumping = true;
        this.elements.character.classList.add('jumping');
        
        // ì í”„ ì†Œë¦¬
        sound.jump();
        
        // íƒ€ì´ë° ì²´í¬
        this.checkTiming();
        
        setTimeout(() => {
          this.isJumping = false;
          this.elements.character.classList.remove('jumping');
        }, 250);  // ì í”„ ì‹œê°„
      },
      
      // ë”ë¸” ì í”„ ì „ìš© ì²´í¬
      checkDoubleJump() {
        const normalizedAngle = this.ropeAngle % 360;
        const currentRotation = Math.floor(this.ropeAngle / 360);
        
        // íƒ€ì´ë° ìœˆë„ìš° í™•ì¥ (ë”ë¸” ì í”„ëŠ” ì¡°ê¸ˆ ë” ì—¬ìœ ìˆê²Œ)
        if (normalizedAngle >= 140 && normalizedAngle <= 220) {
          // ì´ë¯¸ ì´ë²ˆ íšŒì „ì—ì„œ ì²« ì í”„ë¥¼ í–ˆê³ , ë”ë¸” ì í”„ ì•„ì§ ì•ˆ í–ˆìœ¼ë©´
          if (this.jumpCountThisRotation === 1 && this.lastRotation === currentRotation) {
            this.jumpCountThisRotation = 2;
            this.addScore(50, 'DOUBLE! ğŸŒŸğŸŒŸ');
            sound.double();
            this.showDoubleJumpAlert();
          }
        }
      },
      
      checkTiming() {
        const normalizedAngle = this.ropeAngle % 360;
        const currentRotation = Math.floor(this.ropeAngle / 360);
        
        // ìƒˆ íšŒì „ì´ ì‹œì‘ë˜ë©´ ì í”„ ì¹´ìš´íŠ¸ ë¦¬ì…‹
        if (currentRotation !== this.lastRotation) {
          this.lastRotation = currentRotation;
          this.jumpCountThisRotation = 0;
        }
        
        // ì¤„ì´ ë°”ë‹¥ ê·¼ì²˜(160~200ë„)ì¼ ë•Œ ì í”„í•´ì•¼ í•¨
        const { start, end } = this.jumpWindow;
        
        if (normalizedAngle >= start && normalizedAngle <= end) {
          this.jumpCountThisRotation++;
          
          // ì²« ë²ˆì§¸ ì í”„
          if (this.jumpCountThisRotation === 1) {
            if (this.lastJumpAngle !== currentRotation) {
              this.lastJumpAngle = currentRotation;
              
              // Perfect íƒ€ì´ë° (175~185ë„)
              if (normalizedAngle >= 175 && normalizedAngle <= 185) {
                this.addScore(20, 'PERFECT! â­');
                sound.perfect();
              } else {
                this.addScore(10, 'GOOD! ğŸ‘');
                sound.good();
              }
            }
          }
          // ğŸ¯ ë‘ ë²ˆì§¸ ì í”„ = ë”ë¸” ì í”„ ë³´ë„ˆìŠ¤!
          else if (this.jumpCountThisRotation === 2) {
            this.addScore(50, 'DOUBLE! ğŸŒŸğŸŒŸ');
            sound.double();
            this.showDoubleJumpAlert();  // í° ì•Œë¦¼ í‘œì‹œ!
          }
        }
      },
      
      addScore(points, message) {
        this.score += points * (1 + Math.floor(this.combo / 5) * 0.5);
        this.score = Math.floor(this.score);
        this.combo++;
        
        this.elements.score.textContent = this.score;
        
        // ğŸ¶ ì—°ì† í¼í™íŠ¸ ì²´í¬
        if (message.includes('PERFECT')) {
          this.perfectStreak++;
          this.elements.perfectStreak.textContent = this.perfectStreak >= 2 ? `â­Ã—${this.perfectStreak}` : '';
          
          // 3ì—°ì† í¼í™íŠ¸ = ë¬¼ë³‘ ì•„ì´í…œ!
          if (this.perfectStreak >= 3 && this.items.length < 2) {
            this.spawnItem();
            this.perfectStreak = 0;
            this.elements.perfectStreak.textContent = '';
          }
        } else if (!message.includes('DOUBLE')) {
          // GOODì´ë©´ ì—°ì† í¼í™íŠ¸ ë¦¬ì…‹ (DOUBLEì€ ë¦¬ì…‹ ì•ˆ í•¨)
          this.perfectStreak = 0;
          this.elements.perfectStreak.textContent = '';
        }
        
        // ì½¤ë³´ í‘œì‹œ
        if (this.combo >= 3) {
          this.elements.combo.textContent = `ğŸ”¥ ${this.combo} COMBO!`;
          this.elements.combo.classList.remove('hidden');
          if (this.combo % 5 === 0) sound.combo(); // 5ì½¤ë³´ë§ˆë‹¤ ì†Œë¦¬
        }
        
        // ğŸ¶ ì½¤ë³´ 10ë²ˆë§ˆë‹¤ ë¬¼ë³‘ ì•„ì´í…œ!
        if (this.combo > 0 && this.combo % 10 === 0 && this.items.length < 2) {
          this.spawnItem();
        }
        
        // íƒ€ì´ë° í‘œì‹œ
        let type = 'good';
        if (message.includes('DOUBLE')) type = 'double';
        else if (message.includes('PERFECT')) type = 'perfect';
        this.showTiming(message, type);
        
        // ë ˆë²¨ì—… (50ì ë§ˆë‹¤)
        const newLevel = Math.floor(this.score / 50) + 1;
        if (newLevel > this.level) {
          this.level = newLevel;
          this.baseRopeSpeed = Math.min(3 + (this.level - 1) * 0.5, 8);
          if (!this.isSlowMode) {
            this.ropeSpeed = this.baseRopeSpeed;
          }
          this.elements.difficulty.textContent = `Lv.${this.level}`;
          sound.levelUp(); // ë ˆë²¨ì—… ì†Œë¦¬
        }
      },
      
      // ğŸ¶ ì•„ì´í…œ ìƒì„±
      spawnItem() {
        // ë¹ˆ ìŠ¬ë¡¯ ì°¾ê¸°
        let slot = null;
        if (!this.items.includes('left')) {
          slot = 'left';
        } else if (!this.items.includes('right')) {
          slot = 'right';
        } else {
          return; // ìŠ¬ë¡¯ ê½‰ ì°¸
        }
        
        this.items.push(slot);
        sound.itemGet();
        
        const slotElement = slot === 'left' ? this.elements.itemSlotLeft : this.elements.itemSlotRight;
        const bottle = document.createElement('div');
        bottle.className = 'water-bottle';
        bottle.dataset.slot = slot;
        
        // í´ë¦­/í„°ì¹˜ ì´ë²¤íŠ¸
        const useItem = (e) => {
          e.stopPropagation();
          this.useItem(slot);
        };
        bottle.addEventListener('click', useItem);
        bottle.addEventListener('touchstart', (e) => {
          e.preventDefault();
          useItem(e);
        }, { passive: false });
        
        slotElement.appendChild(bottle);
      },
      
      // â¸ï¸ ì•„ì´í…œ ì‚¬ìš© (3ì´ˆ ì •ì§€ + 10ì´ˆ ìŠ¬ë¡œìš°)
      useItem(slot) {
        if (!this.items.includes(slot)) return;
        
        // ì•„ì´í…œ ì œê±°
        this.items = this.items.filter(s => s !== slot);
        const slotElement = slot === 'left' ? this.elements.itemSlotLeft : this.elements.itemSlotRight;
        slotElement.innerHTML = '';
        
        // ê¸°ì¡´ íƒ€ì´ë¨¸ ì •ë¦¬
        if (this.freezeTimer) clearTimeout(this.freezeTimer);
        if (this.countdownTimer) clearInterval(this.countdownTimer);
        
        // 1ë‹¨ê³„: 3ì´ˆ ì •ì§€ ëª¨ë“œ í™œì„±í™”
        sound.slowMode();
        this.isSlowMode = true;
        this.ropeSpeed = 0; // ì™„ì „ ì •ì§€!
        this.elements.gameContainer.classList.add('slow-mode');
        
        // ì´ 13ì´ˆ: 3ì´ˆ ì •ì§€ + 5ì´ˆ 50% + 5ì´ˆ ì ì  ë³µê·€
        let totalSeconds = 13;
        let currentSecond = 0;
        
        this.showCountdown('â¸ï¸');
        
        this.countdownTimer = setInterval(() => {
          currentSecond++;
          
          if (currentSecond <= 3) {
            // 1ë‹¨ê³„: ì •ì§€ (1~3ì´ˆ)
            this.ropeSpeed = 0;
            this.showCountdown(`â¸ï¸ ${3 - currentSecond + 1}`);
          } else if (currentSecond <= 8) {
            // 2ë‹¨ê³„: 50% ìŠ¬ë¡œìš° (4~8ì´ˆ)
            this.ropeSpeed = this.baseRopeSpeed * 0.5;
            this.showCountdown(`ğŸ¢ ${8 - currentSecond + 1}`);
          } else if (currentSecond <= 13) {
            // 3ë‹¨ê³„: ì ì  ë³µê·€ 50% â†’ 80% (9~13ì´ˆ)
            const progress = (currentSecond - 8) / 5; // 0 â†’ 1
            const speedMultiplier = 0.5 + (0.3 * progress); // 0.5 â†’ 0.8
            this.ropeSpeed = this.baseRopeSpeed * speedMultiplier;
            this.showCountdown(`âš¡ ${13 - currentSecond + 1}`);
          }
          
          if (currentSecond >= totalSeconds) {
            // íš¨ê³¼ ì¢…ë£Œ
            clearInterval(this.countdownTimer);
            this.isSlowMode = false;
            this.ropeSpeed = this.baseRopeSpeed;
            this.elements.gameContainer.classList.remove('slow-mode');
            this.hideCountdown();
          }
        }, 1000);
      },
      
      // ì¹´ìš´íŠ¸ë‹¤ìš´ í‘œì‹œ
      showCountdown(text) {
        let countdown = document.getElementById('slowCountdown');
        if (!countdown) {
          countdown = document.createElement('div');
          countdown.id = 'slowCountdown';
          countdown.style.cssText = `
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 60px;
            font-weight: bold;
            z-index: 50;
            pointer-events: none;
            animation: countdownPulse 1s ease-in-out;
          `;
          this.elements.gameContainer.appendChild(countdown);
        }
        countdown.textContent = text;
        
        // ë‹¨ê³„ë³„ ìƒ‰ìƒ
        if (text.includes('â¸ï¸')) {
          countdown.style.color = '#E91E63';  // í•‘í¬ (ì •ì§€)
          countdown.style.textShadow = '0 0 20px white, 0 0 40px #E91E63';
        } else if (text.includes('ğŸ¢')) {
          countdown.style.color = '#29B6F6';  // íŒŒë‘ (ìŠ¬ë¡œìš°)
          countdown.style.textShadow = '0 0 20px white, 0 0 40px #29B6F6';
        } else if (text.includes('âš¡')) {
          countdown.style.color = '#FFC107';  // ë…¸ë‘ (ë³µê·€ ì¤‘)
          countdown.style.textShadow = '0 0 20px white, 0 0 40px #FFC107';
        }
        
        countdown.style.animation = 'none';
        countdown.offsetHeight; // reflow
        countdown.style.animation = 'countdownPulse 1s ease-in-out';
      },
      
      hideCountdown() {
        const countdown = document.getElementById('slowCountdown');
        if (countdown) countdown.remove();
      },
      
      showTiming(text, type) {
        const indicator = this.elements.timingIndicator;
        indicator.textContent = text;
        indicator.className = `timing-indicator ${type} show`;
        
        setTimeout(() => {
          indicator.classList.remove('show');
        }, 500);
      },
      
      // ğŸŒŸ 2ë‹¨ ë›°ê¸° í° ì•Œë¦¼ í‘œì‹œ
      showDoubleJumpAlert() {
        const alert = this.elements.doubleJumpAlert;
        const container = this.elements.gameContainer;
        
        // ê¸°ì¡´ ì• ë‹ˆë©”ì´ì…˜ ë¦¬ì…‹
        alert.classList.remove('show');
        container.classList.remove('flash');
        
        // ê°•ì œ reflow
        void alert.offsetWidth;
        
        // ìƒˆ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
        alert.classList.add('show');
        container.classList.add('flash');
        
        setTimeout(() => {
          alert.classList.remove('show');
          container.classList.remove('flash');
        }, 800);
      },
      
      gameLoop() {
        if (!this.isPlaying) return;
        
        // ì¤„ íšŒì „
        this.ropeAngle += this.ropeSpeed;
        const visualAngle = this.ropeAngle % 360;
        
        // ì¤„ì´ 180ë„(ë°”ë‹¥)ë¥¼ ì§€ë‚˜ê°ˆ ë•Œ ì í”„ ì•ˆ í–ˆìœ¼ë©´ ê²Œì„ ì˜¤ë²„
        const currentRotation = Math.floor(this.ropeAngle / 360);
        
        // ë°”ë‹¥ í†µê³¼ ì²´í¬ (200ë„ ì´í›„)
        if (visualAngle > 200 && visualAngle < 210) {
          if (this.lastJumpAngle !== currentRotation && !this.isJumping) {
            // ì í”„ ì•ˆ í•˜ê³  ì¤„ì´ ì§€ë‚˜ê° = ê²Œì„ ì˜¤ë²„
            this.gameOver();
            return;
          }
        }
        
        // ğŸ¨ 3D ì…ì²´ê° íš¨ê³¼ ê°œì„ 
        const angleRad = visualAngle * Math.PI / 180;
        
        // Y ìœ„ì¹˜ (ìœ„ì•„ë˜ ì›€ì§ì„)
        const translateY = Math.sin(angleRad) * 85;
        
        // ì›ê·¼ê° ìŠ¤ì¼€ì¼ (ì•ìœ¼ë¡œ ì˜¬ìˆ˜ë¡ ì»¤ì§)
        // 180ë„ì—ì„œ ìµœëŒ€ (1.4), 0/360ë„ì—ì„œ ìµœì†Œ (0.5)
        const depthScale = 0.5 + 0.9 * Math.sin(angleRad);
        
        // ì¤„ ë‘ê»˜ë„ ì›ê·¼ê° ì ìš©
        const ropeHeight = 3 + 5 * Math.sin(angleRad);
        
        // ì¤„ ë„ˆë¹„ë„ ì›ê·¼ê° (ì•ì—ì„œ ë” ë„“ê²Œ)
        const ropeWidth = 180 + 40 * Math.sin(angleRad);
        
        // ì¤„ ì„¸ë¡œ ìŠ¤ì¼€ì¼ (íšŒì „ ì‹œê° íš¨ê³¼)
        const scaleY = Math.abs(Math.cos(angleRad));
        
        // ìŠ¤íƒ€ì¼ ì ìš©
        this.elements.rope.style.transform = 
          `translateX(-50%) translateY(${-translateY}px) scaleY(${Math.max(0.1, scaleY)}) scale(${depthScale})`;
        this.elements.rope.style.height = `${ropeHeight}px`;
        this.elements.rope.style.width = `${ropeWidth}px`;
        
        // ì¤„ íë¦¼ íš¨ê³¼ (ë©€ë¦¬ ìˆì„ ë•Œ ì•½ê°„ íë¦¬ê²Œ)
        const blur = visualAngle < 90 || visualAngle > 270 ? 1 : 0;
        this.elements.rope.style.filter = `blur(${blur}px)`;
        
        // ì¤„ íˆ¬ëª…ë„ (ë©€ë¦¬ ìˆì„ ë•Œ ì•½ê°„ íˆ¬ëª…)
        const opacity = 0.7 + 0.3 * Math.sin(angleRad);
        this.elements.rope.style.opacity = opacity;
        
        // z-index ì¡°ì ˆ (ì¤„ì´ ì•ìª½ ë°˜êµ¬ì— ìˆì„ ë•Œ ìºë¦­í„°ë¥¼ ê°€ë¦¼)
        // âš ï¸ ropeContainerì˜ z-indexë¥¼ ë³€ê²½í•´ì•¼ í•¨ (ropeëŠ” container ì•ˆì— ìˆì–´ì„œ ì•ˆ ë¨¹í˜)
        // ìºë¦­í„° z-index: 5
        // 0~180ë„: ì¤„ì´ ì•ìª½ì—ì„œ ìœ„â†’ì•„ë˜ë¡œ ë‚´ë ¤ì˜´ â†’ ìºë¦­í„° ì• (ê°€ë¦¼)
        // 180~360ë„: ì¤„ì´ ë’¤ìª½ì—ì„œ ì•„ë˜â†’ìœ„ë¡œ ì˜¬ë¼ê° â†’ ìºë¦­í„° ë’¤ (ê°€ë ¤ì§)
        if (visualAngle <= 180) {
          // ì¤„ì´ ì•ìª½ ë°˜êµ¬ (ìœ„ì—ì„œ ë°”ë‹¥ìœ¼ë¡œ ë‚´ë ¤ì˜´) - ìºë¦­í„°ë¥¼ ê°€ë¦¼
          this.elements.ropeContainer.style.zIndex = '10';
        } else {
          // ì¤„ì´ ë’¤ìª½ ë°˜êµ¬ (ë°”ë‹¥ì—ì„œ ë’¤ë¡œ ì˜¬ë¼ê°) - ìºë¦­í„°ì— ê°€ë ¤ì§
          this.elements.ropeContainer.style.zIndex = '1';
        }
        
        requestAnimationFrame(() => this.gameLoop());
      },
      
      gameOver() {
        this.isPlaying = false;
        this.showTiming('MISS! ğŸ’¥', 'miss');
        sound.miss(); // ì‹¤íŒ¨ ì†Œë¦¬
        
        // ë¬¼ë³‘ íš¨ê³¼ ì •ë¦¬
        if (this.countdownTimer) clearInterval(this.countdownTimer);
        if (this.freezeTimer) clearTimeout(this.freezeTimer);
        this.isSlowMode = false;
        this.elements.gameContainer.classList.remove('slow-mode');
        this.hideCountdown();
        
        setTimeout(() => {
          this.elements.gameOverScreen.classList.remove('hidden');
          this.elements.finalScore.textContent = this.score;
          this.elements.tapHint.classList.add('hidden');
          sound.gameOver(); // ê²Œì„ ì˜¤ë²„ ì†Œë¦¬
        }, 500);
      }
    };
    
    game.init();
  </script>
</body>
</html>
